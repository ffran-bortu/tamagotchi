<div class="flex flex-col h-full" style="height: 100%; position: relative;">
    <!-- Fixed Top Section: Title + Pet Preview -->
    <div id="closet-top-section" class="flex-shrink-0 flex flex-col p-4 pt-2 gap-4">
        <div class="flex items-center justify-between">
            <button id="closet-back-button" class="text-black hover:text-gray-800 transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <h1 class="font-pixel text-lg md:text-xl text-retro-light tracking-widest uppercase drop-shadow-md flex-1 text-center">THE CLOSET</h1>
            <div class="w-10"></div> <!-- Spacer for centering -->
        </div>

        <div id="closet-preview" class="relative w-full aspect-square max-h-[360px] border-8 border-retro-indigo rounded-lg bg-[#111] overflow-hidden shadow-lg">
            <!-- Layer 0: Background Canvas -->
            <canvas id="closet-bg-canvas" class="absolute inset-0 w-full h-full"
                style="image-rendering: pixelated;"></canvas>

            <!-- Layer 1: Pet Sprite Canvas (Animated) -->
            <canvas id="closet-sprite-canvas" class="absolute inset-0 w-full h-full"
                style="image-rendering: pixelated;"></canvas>

            <!-- Layer 2: Accessories/Hats Canvas -->
            <canvas id="closet-accessory-canvas" class="absolute inset-0 w-full h-full"
                style="image-rendering: pixelated;"></canvas>

            <!-- Corner decorations -->
            <div class="absolute top-0 left-0 w-4 h-4 border-t-4 border-l-4 border-white/20 pointer-events-none"></div>
            <div class="absolute top-0 right-0 w-4 h-4 border-t-4 border-r-4 border-white/20 pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 w-4 h-4 border-b-4 border-l-4 border-white/20 pointer-events-none">
            </div>
            <div class="absolute bottom-0 right-0 w-4 h-4 border-b-4 border-r-4 border-white/20 pointer-events-none">
            </div>
        </div>
    </div>

    <!-- Scrollable Bottom Section: Customization Options -->
    <div id="closet-scrollable" class="bg-surface-dark border-t-4 border-retro-border overflow-y-auto scrollbar-hide" style="touch-action: pan-y; -webkit-overflow-scrolling: touch; position: absolute; top: 0; left: 0; right: 0; bottom: 0;">
        <div class="p-4 space-y-6 pb-24">
            <!-- Body Color Section -->
            <div class="space-y-3">
                <h3 class="font-pixel text-xs text-retro-gray uppercase tracking-widest">Body Color</h3>
                <div id="color-selector" class="flex flex-row gap-4 pb-2">
                    <button data-color="1" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #3D5A80;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">BLUE</div>
                    </button>
                    <button data-color="2" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #F5F5F5;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">WHITE</div>
                    </button>
                    <button data-color="3" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #CD5C5C;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">ORANGE</div>
                    </button>
                </div>
            </div>

            <!-- Background Section -->
            <div class="space-y-3">
                <h3 class="font-pixel text-xs text-retro-gray uppercase tracking-widest">Background</h3>
                <div id="background-selector" class="flex flex-row gap-4 pb-2">
                    <button data-background="1" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #6B8C42;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">GREEN</div>
                    </button>
                    <button data-background="2" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #9370DB;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">PURPLE</div>
                    </button>
                    <button data-background="3" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #87CEEB;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">LIGHT BLUE</div>
                    </button>
                    <button data-background="4" class="w-12 h-12 border-4 border-black hover:border-retro-gray shrink-0 transition-transform active:translate-y-1 relative group" style="background-color: #1E3A5F;">
                        <div class="absolute -bottom-6 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 font-terminal text-xs bg-black px-1 pointer-events-none whitespace-nowrap z-50">DARK BLUE</div>
                    </button>
                </div>
            </div>

            <!-- Headwear Section -->
            <div class="space-y-3">
                <h3 class="font-pixel text-xs text-retro-gray uppercase tracking-widest">Headwear</h3>
                <div id="hat-selector" class="grid grid-cols-3 gap-4">
                    <button data-hat="" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <span class="material-symbols-outlined text-retro-gray text-3xl group-hover:-translate-y-1 transition-transform">block</span>
                    </button>
                    <button data-hat="1" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_1.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="2" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_2.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="3" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_3.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="4" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_4.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="5" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_5.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="6" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_6.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="7" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_7.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="8" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_8.png" class="pixel-scale w-12 h-12">
                    </button>
                    <button data-hat="9" class="aspect-square bg-surface-dark border-4 border-black hover:bg-retro-gray hover:border-retro-light flex items-center justify-center group transition-all">
                        <img src="/public/sprites/hats/hat_9.png" class="pixel-scale w-12 h-12">
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<footer class="w-full bg-surface-dark border-t-4 border-retro-gray p-4 flex flex-col shrink-0 fixed bottom-0 max-w-md left-0 right-0 mx-auto z-10">
    <button id="save-outfit-button" class="w-full bg-retro-green border-4 border-black hover:border-white active:translate-y-1 active:shadow-none text-black font-pixel text-sm md:text-base py-4 uppercase tracking-widest shadow-retro-strong transition-all">
        Save Outfit
    </button>
</footer>
